
## Deploy Your Model

Deploying the code generated by the model into the FMT Firmware is a straightforward process. Simply copy the generated source files (*.c, *.h) to the designated location that corresponds to the specific model, replacing the existing code. The following path indicates where the model code should be stored:

- **FMS**: `FMT-Firmware/src/model/fms/base_fms/lib`
- **INS**: `FMT-Firmware/src/model/ins/base_ins/lib`
- **Controller**: `FMT-Firmware/src/model/control/base_controller/lib`
- **Plant**: `FMT-Firmware/src/model/plant/multicopter/lib`

If a corresponding model directory does not exist for your model, you can follow the steps below to create one, using the controller as an example:

1. Copy the directory `FMT-Firmware/src/model/control/template_controller` and assign it a new name, such as `FMT-Firmware/src/model/control/my_controller`.
2. Copy all the generated code files (*.c, *.h) to the `FMT-Firmware/src/model/control/my_controller/lib` directory.
3. Open the `control_interface.c` file and make the necessary modifications. This involves adding parameters and logs based on the requirements of your model, as well as making any other adjustments that may be necessary to ensure proper integration.

## Model Interface

The Model Interface is a C file that establishes a connection between the embedded system and the generated model file. The responsibilities of the model interface include:

- Calling the Init() and Step() functions of the Model.
- Subscribing to input data of the Model, and publishing Model output data.
- Defining model parameters and binding them to the Model's parameters (optional).
- Defining model log data for data simulation or recording purposes (optional).

 <p align="center">
 	<img src="./figures/model_interface.png" width="30%">
 </p>

## Deploy C/C++ Code

If you have an algorithm written in C/C++ that you wish to integrate into the FMT-Firmware, it is indeed possible. The overall process is similar to deploying a model. For more detailed information and guidance, you can refer to the `FMT-Firmware/src/model/ins/px4_ecl` directory. This directory provides insights into how to integrate custom algorithms into the FMT-Firmware.

By examining the content and structure of the FMT-Firmware/src/model/ins/px4_ecl directory, you can gain valuable insights into the steps involved in integrating your own C/C++ algorithm. 

## Build Your Model
To build your model, you can make modifications to the model.py file located within your Board Support Package (BSP) configuration folder. By accessing and modifying this file, you can customize the build process of models according to your specific requirements and preferences. 

The following is an example:

```python
# Modify this file to decide which model are compiled
from building import *

vehicle_type = GetOption('vehicle')

if vehicle_type == 'Multicopter':
    MODELS = [
        'plant/multicopter',
        'ins/base_ins',
        'fms/base_fms',
        'control/base_controller',
    ]
elif vehicle_type == 'Fixwing':
    MODELS = [
        'plant/fixwing',
        'ins/base_ins',
        'fms/fw_fms',
        'control/fw_controller',
    ]
elif vehicle_type == 'Template':
    MODELS = [
        'plant/template_plant',
        'ins/template_ins',
        'fms/template_fms',
        'control/template_controller',
    ]
else:
    raise Exception("Wrong VEHICLE_TYPE %s defined" % vehicle_type)
```

When invoking the build process using `scons -j4 --vehicle=Multicopter`, the models defined in the **MODELS** are used. If you want to transition to another Inertial Navigation System (INS) model, such as EKF, you have the option to modify the `ins/base_ins` reference to `ins/px4_ecl`. Moreover, you retain the flexibility to introduce a new `vehicle_type` and build your custom model into the system.
